<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Home</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta charset="utf-8">
		<meta name="keywords" content="" />
		<link rel="stylesheet" href="//cdnjs.loli.net/ajax/libs/mdui/0.4.2/css/mdui.min.css">
		<script src="//cdnjs.loli.net/ajax/libs/mdui/0.4.2/js/mdui.min.js"></script>
		<script src="js/jquery-2.1.4.min.js"></script>
		<script src="js/index_beta.js"></script>
		<script src="js/utils.js"></script>
	</head>
	<body onload="initPage();" class="mdui-drawer-body-left mdui-appbar-with-toolbar mdui-theme-primary-pink ">
		<div class="mdui-appbar mdui-appbar-fixed">
		<div class="mdui-toolbar mdui-color-theme">
			<a class="mdui-btn mdui-btn-icon" mdui-drawer="{target: '#left-drawer'}"><i class="mdui-icon material-icons">menu</i></a>
			<a href="javascript:;" class="mdui-typo-headline">期货交易系统</a>
			<a href="javascript:;" class="mdui-typo-title">持仓管理</a>
			<div class="mdui-toolbar-spacer"></div>
			<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>
			<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">refresh</i></a>
			<a onclick="logOut();" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">exit_to_app</i></a>
		</div>
	</div>

	<div class="mdui-drawer mdui-shadow-5" id="left-drawer">
		<div class="mdui-spinner mdui-spinner-colorful" id="loader" style="display: block;margin-left:auto;margin-right:auto;margin-top: 50%"></div>
		<div class="mdui-list mdui-collapse" mdui-collapse="{accordion:true}" id="drawer"></div>

	</div>
		<select class="mdui-select" id="sel1" mdui-select>
			<option value="StockId">股票ID</option>
			<option value="StockName">股票名称</option>
			<option value="Quantity">持有数量</option>
		</select>
		<select class="mdui-select" id="sel2" mdui-select>
			<option value="StockId">股票ID</option>
			<option value="StockName">股票名称</option>
			<option value="Quantity">持有数量</option>
		</select>
		<select class="mdui-select" id="sel3" mdui-select>
			<option value="StockId">股票ID</option>
			<option value="StockName">股票名称</option>
			<option value="Quantity">持有数量</option>
		</select>
		<button class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent" onclick="show()">显示</button>
		<button class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent" onclick="hide()">隐藏</button>
		<div>
			<div name="chaxunForm" style="float:left;">

				<button class="mdui-btn" mdui-dialog="{'target':'#search_dialog'}">查找</button>
				<button type="button" class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent" onclick="add()">添加</button>
				<button type="button" class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent" onclick="window.location='wh_print.html'">打印</button>
				<a href = "whdataToCSV" class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent">导出</a>
				<button type="button" class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent" onclick="window.location='wh_statistics.html'">统计</button>
			</div>

			<div class="mdui-dialog" id="search_dialog">
				<div class="mdui-dialog-title">持仓查找</div>
				<form name="user_search_form" class="mdui-dialog-content">
					<div class="mdui-textfield">

						<div class="mdui-textfield mdui-textfield-floating-label">
							<label class="mdui-textfield-label">股票ID</label>
							<input class="mdui-textfield-input" id="StockId" name="StockId" type="text" value=""/>
						</div>

						<div class="mdui-textfield mdui-textfield-floating-label">
							<label class="mdui-textfield-label">股票名称</label>
							<input class="mdui-textfield-input" id="StockName" name="StockName" type="text" value=""/>
						</div>

					</div>
				</form>
				<div class="mdui-dialog-actions">
					<button class="mdui-btn" onclick="query()" mdui-dialog-confirm>
						搜索
					</button>
				</div>
			</div>

			<div class="mdui-table-fluid">
				<table class="mdui-table mdui-table-hoverable">
					<thead>
					<tr>
						<th>股票ID</th>
						<th>股票名称</th>
						<th>持有数量</th>
						<th>交易日期</th>
						<th>操作</th>
					</tr>
					</thead>
					<tbody id="wh_list">

					</tbody>
				</table>
			</div>
		</div>

	</body>
</html>

<script>
	var wh_info;
	function add(){
		window.location.href="wh_register.html";
	}
	function modify(id){
		window.location.href = "wh_change.html?stockid="+id;
	}
	function home(){
		window.location="wh_query_list.html";
	}
	function delet(id){
		var url = "deleteAction?StockId="+id;
		url=getQueryPath(url);
		var data1 = '{"StockId":"'+id+'"}';

		var obj = JSON.parse(data1);

		$.post(url,obj,function(json){
			console.log(JSON.stringify(json));
			//initMenu(json);
		})
		alert("删除成功!");

	}

	function exported(){
		var url = "whdataToCSV";
		url=getQueryPath(url);
		var coo = getCookie("tocken");

		var data1 = '{"Cookie":"'+coo+'"}';
		console.log("================");
		var obj = JSON.parse(data1);
		console.log(data1);
		$.post(url,obj,function(json){
			console.log(JSON.stringify(json));
		})
	}

	function query(){
		var url = "chaxunAction";
		url=getQueryPath(url);
		console.log("22222222222222");
		var stockid = document.getElementById("StockId").value;
		var stockname = document.getElementById("StockName").value;
		var coo = getCookie("tocken");
		console.log("11111111111111111");
		var data1 = '{"StockId":"'+stockid+'","StockName":"'+stockname+'","Cookie":"'+coo+'"}';
		console.log("================");
		var obj = JSON.parse(data1);
		console.log(data1);
		$.post(url,obj,function(json){
			console.log(JSON.stringify(json));
			updateTable(json);
		})
	}

	function updateTable(json){
		wh_info=json.list;
		var table = document.getElementById('wh_list');
		table.innerHTML="";
		for(var i=0;i<json.list.length;i++){
			var row = document.createElement('tr');
			var id=json.list[i].stockid;

			var stockId = document.createElement('td');
			stockId.innerText=json.list[i].stockid;
			row.appendChild(stockId);

			var stockName = document.createElement('td');
			stockName.innerText=json.list[i].stockname;
			row.appendChild(stockName);

			var Quantity = document.createElement('td');
			Quantity.innerText=json.list[i].quantity;
			row.appendChild(Quantity);

			var createAt = document.createElement('td');
			createAt.innerText=json.list[i].createat;
			row.appendChild(createAt);

			var buttonBox = document.createElement('td');
			var button = document.createElement('button');
			button.className="mdui-btn mdui-color-theme-accent"
			button.setAttribute("mdui-menu","{target:'#userMenu"+i+"',position:'bottom',fixed:true}");
			button.innerText="编辑";


			var menu = document.createElement('ul');
			menu.id="userMenu"+i;
			menu.className="mdui-menu";
			var item = document.createElement('li');
			item.className="mdui-menu-item";
			item.onclick="delet("+id+")";
			item.innerHTML="<a onclick='delet("+id+")'>删除</a>";
			menu.appendChild(item);
			var item = document.createElement('li');
			item.className="mdui-menu-item";
			item.innerHTML="<a onclick='modify("+id+")'>修改</a>";
			menu.appendChild(item);
			buttonBox.appendChild(button);
			buttonBox.appendChild(menu);
			row.appendChild(buttonBox);
			table.appendChild(row);
		}
		mdui.updateTables("#wh_list")
	}




	function show(){

		var url = "querylistAction";
		url=getQueryPath(url);
		var sel1 = document.getElementById("sel1").value;
		var sel2 = document.getElementById("sel2").value;
		var sel3 = document.getElementById("sel3").value;
		//var sel4 = document.getElementById("sel4").value;

		var coo = getCookie("tocken");

		var data1 = '{"Sel1":"'+sel1+'","Sel2":"'+sel2+'","Sel3":"'+sel3+'","Cookie":"'+coo+'"}';

		var obj = JSON.parse(data1);
		$.post(url,obj,function(json){
			//console.log(JSON.stringify(json));
			wh_info=json.list;
			updateTable(json);
		})
	}

	function hide(){
		var table = document.getElementById('wh_list');
		table.innerHTML="";
	}


</script>