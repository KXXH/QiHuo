<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Home</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta charset="utf-8">
		<meta name="keywords" content="" />
		<link rel="stylesheet" href="//cdnjs.loli.net/ajax/libs/mdui/0.4.2/css/mdui.min.css">
		<script src="//cdnjs.loli.net/ajax/libs/mdui/0.4.2/js/mdui.min.js"></script>
		<script src="js/jquery-2.1.4.min.js"></script>
		<script src="js/index_beta.js"></script>
		<script src="js/utils.js"></script>
	</head>
	<body onload="initPage();" class="mdui-drawer-body-left mdui-appbar-with-toolbar mdui-theme-primary-pink ">
		<div class="mdui-appbar mdui-appbar-fixed">
		<div class="mdui-toolbar mdui-color-theme">
			<a class="mdui-btn mdui-btn-icon" mdui-drawer="{target: '#left-drawer'}"><i class="mdui-icon material-icons">menu</i></a>
			<a href="javascript:;" class="mdui-typo-headline">期货交易系统</a>
			<a href="javascript:;" class="mdui-typo-title">首页</a>
			<div class="mdui-toolbar-spacer"></div>
			<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>
			<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">refresh</i></a>
			<a onclick="logOut();" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">exit_to_app</i></a>
		</div>
	</div>

	<div class="mdui-drawer mdui-shadow-5" id="left-drawer">
		<div class="mdui-spinner mdui-spinner-colorful" id="loader" style="display: block;margin-left:auto;margin-right:auto;margin-top: 50%"></div>
		<div class="mdui-list mdui-collapse" mdui-collapse="{accordion:true}" id="drawer"></div>

	</div>
		<select class="mdui-select" id="sel1" mdui-select>
			<option value="OrderId">订单号</option>
			<option value="UserId">用户ID</option>
			<option value="UserName">用户名称</option>
			<option value="StockId">股票ID</option>
			<option value="StockName">股票名称</option>
			<option value="Quantity">持有数量</option>
			<option value="BUnitPrice">订单价格</option>
			<option value="CreateAt">创建时间</option>
		</select>
		<select class="mdui-select" id="sel2" mdui-select>
			<option value="OrderId">订单号</option>
			<option value="UserId">用户ID</option>
			<option value="UserName">用户名称</option>
			<option value="StockId">股票ID</option>
			<option value="StockName">股票名称</option>
			<option value="Quantity">持有数量</option>
			<option value="BUnitPrice">订单价格</option>
			<option value="CreateAt">创建时间</option>
		</select>
		<select class="mdui-select" id="sel3" mdui-select>
			<option value="OrderId">订单号</option>
			<option value="UserId">用户ID</option>
			<option value="UserName">用户名称</option>
			<option value="StockId">股票ID</option>
			<option value="StockName">股票名称</option>
			<option value="Quantity">持有数量</option>
			<option value="BUnitPrice">订单价格</option>
			<option value="CreateAt">创建时间</option>
		</select>
		<select class="mdui-select" id="sel4" mdui-select>
			<option value="OrderId">订单号</option>
			<option value="UserId">用户ID</option>
			<option value="UserName">用户名称</option>
			<option value="StockId">股票ID</option>
			<option value="StockName">股票名称</option>
			<option value="Quantity">持有数量</option>
			<option value="BUnitPrice">订单价格</option>
			<option value="CreateAt">创建时间</option>
		</select>
		<button class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent" onclick="show()">显示</button>
		<div>
			<button type="button" class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent" onclick="window.location='wh_print.html'">打印</button>
			<a href = "busdataToCSV" class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent">导出</a>
			<button type="button" class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent" onclick="window.location='bus_statistics.html'">统计</button>
			<button type="button"class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent" onclick="home()">仓库主页</button>
		</div>
		<div>
			<div name="chaxunForm" style="float:left;">
				<div class="mdui-textfield mdui-textfield-floating-label">
					<label class="mdui-textfield-label" style="width:250px">订单号</label>
					<input class="mdui-textfield-input" style="width:250px" id="OrderId" name="OrderId" type="text" value=""/>
				</div>

				<div class="mdui-textfield mdui-textfield-floating-label">
					<label class="mdui-textfield-label" style="width:250px">用户ID(必填)</label>
					<input class="mdui-textfield-input" style="width:250px" id="UserId" name="UserId" type="text" value=""/>
				</div>

				<div class="mdui-textfield mdui-textfield-floating-label">
					<label class="mdui-textfield-label" style="width:250px">用户名称</label>
					<input class="mdui-textfield-input" style="width:250px" id="UserName" name="UserName" type="text" value=""/>
				</div>

				<div class="mdui-textfield mdui-textfield-floating-label">
					<label class="mdui-textfield-label" style="width:250px">股票ID</label>
					<input class="mdui-textfield-input" style="width:250px" id="StockId" name="StockId" type="text" value=""/>
				</div>

				<div class="mdui-textfield mdui-textfield-floating-label">
					<label class="mdui-textfield-label" style="width:250px">股票名称</label>
					<input class="mdui-textfield-input" style="width:250px" id="StockName" name="StockName" type="text" value=""/>
				</div>
				<button type="button" class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent" onclick="query()">查询</button>
			</div>

			<div class="mdui-table-fluid">
				<table class="mdui-table mdui-table-hoverable" id="bus_table">
					<thead>
					<tr>
						<th>订单号</th>
						<th>用户ID</th>
						<th>用户名称</th>
						<th>股票ID</th>
						<th>股票名称</th>
						<th>持有数量</th>
						<th>订单价格</th>
						<th>交易日期</th>
						<th>操作</th>
					</tr>
					</thead>
					<tbody id="bus_list">

					</tbody>
				</table>
				<button class="mdui-btn" onclick="show()" style="width: 100%">加载更多</button>
			</div>

			<div class="mdui-typo">
				<h1>交易记录新增统计</h1>
				<div class="mdui-img-fluid" id="chartdiv">

				</div>
			</div>
		</div>

	</body>
</html>

<script src="https://www.amcharts.com/lib/4/core.js"></script>
<script src="https://www.amcharts.com/lib/4/charts.js"></script>
<script src="https://www.amcharts.com/lib/4/themes/material.js"></script>
<script src="https://www.amcharts.com/lib/4/lang/de_DE.js"></script>
<script src="https://www.amcharts.com/lib/4/geodata/germanyLow.js"></script>

<script>
	var bus_info;
	var bus_count=0;
	function modify(id){
		window.location.href = "bus_change.html?orderid="+id;
	}
	function home(){
		window.location="bus_query_list.html";
	}
	function delet(id){
		var url = "busdeleteAction?OrderId="+id;
		url=getQueryPath(url);
		var data1 = '{"StockId":"'+id+'"}';

		var obj = JSON.parse(data1);

		$.post(url,obj,function(json){
			console.log(JSON.stringify(json));
			//initMenu(json);
		})
		alert("删除成功!");

	}

	function exported(){
		var url = "busdataToCSV";
		url=getQueryPath(url);
		$.post(url,function(json){
			console.log(JSON.stringify(json));
		})
	}

	function query(){
		var url = "buschaxunAction";
		url=getQueryPath(url);
		console.log("22222222222222");
		var orderid = document.getElementById("OrderId").value;
		var userid = document.getElementById("UserId").value;
		var username = document.getElementById("UserName").value;
		var stockid = document.getElementById("StockId").value;
		var stockname = document.getElementById("StockName").value;
		//var coo = getCookie("tocken");
		console.log("11111111111111111");
		var data1 = '{"OrderId":"'+orderid+'","UserId":"'+userid+'","UserName":"'+username+'","StockId":"'+stockid+'","StockName":"'+stockname+'"}';
		console.log("================");
		var obj = JSON.parse(data1);
		console.log(data1);
		$.post(url,obj,function(json){
			console.log(JSON.stringify(json));
			updateTable(json);
		})
	}

	function updateTable(json){
		bus_info=json.list;
		var table = document.getElementById('bus_list');

		for(var i=0;i<json.list.length;i++){
			var row = document.createElement('tr');
			var id=json.list[i].orderid;

			var orderId = document.createElement('td');
			orderId.innerText=json.list[i].orderid;
			row.appendChild(orderId);

			var userId = document.createElement('td');
			userId.innerText=json.list[i].userid;
			row.appendChild(userId);

			var userName = document.createElement('td');
			userName.innerText=json.list[i].username;
			row.appendChild(userName);

			var stockId = document.createElement('td');
			stockId.innerText=json.list[i].stockid;
			row.appendChild(stockId);

			var stockName = document.createElement('td');
			stockName.innerText=json.list[i].stockname;
			row.appendChild(stockName);

			var Quantity = document.createElement('td');
			Quantity.innerText=json.list[i].quantity;
			row.appendChild(Quantity);

			var BUnitPrice = document.createElement('td');
			BUnitPrice.innerText=json.list[i].bunitprice;
			row.appendChild(BUnitPrice);

			var createAt = document.createElement('td');
			createAt.innerText=json.list[i].createat;
			row.appendChild(createAt);

			var buttonBox = document.createElement('td');
			var button = document.createElement('button');
			button.className="mdui-btn mdui-color-theme-accent"
			button.setAttribute("mdui-menu","{target:'#userMenu"+i+"',position:'bottom',fixed:true}");
			button.innerText="编辑";


			var menu = document.createElement('ul');
			menu.id="userMenu"+i;
			menu.className="mdui-menu";
			var item = document.createElement('li');
			item.className="mdui-menu-item";
			item.onclick="delet("+id+")";
			item.innerHTML="<a onclick='delet("+id+")'>删除</a>";
			menu.appendChild(item);
			var item = document.createElement('li');
			item.className="mdui-menu-item";
			item.innerHTML="<a onclick='modify("+id+")'>修改</a>";
			menu.appendChild(item);
			buttonBox.appendChild(button);
			buttonBox.appendChild(menu);
			row.appendChild(buttonBox);
			table.appendChild(row);
		}
		mdui.updateTables("#bus_list")
	}
	

	function show(){

		var url = "busquerylistAction";
		url=getQueryPath(url);
		var sel1 = document.getElementById("sel1").value;
		var sel2 = document.getElementById("sel2").value;
		var sel3 = document.getElementById("sel3").value;
		var sel4 = document.getElementById("sel4").value;


		var data1 = '{"Sel1":"'+sel1+'","Sel2":"'+sel2+'","Sel3":"'+sel3+'","Sel4":"'+sel4+'","count":"'+bus_count+'"}';

		var j = JSON.parse(data1);
		$.post(url,j,function(json){
			//console.log(JSON.stringify(json));
			bus_info=json.list;

			if(json.status=="ok"){
				updateTable(json);
				bus_count=json.count;
			}else if(json.status=="error"){
				mdui.alert(json.error,"错误");
			}else if(json.status=="end"){
				mdui.snackbar("已经到达最后了!");
				updateTable(json);
			}
		})
		statistics();
	}



	function  drawChart(json){
		console.log('开始绘图');
		var chart=am4core.create("chartdiv",am4charts.XYChart);
		chart.dateFormatter.inputDateFormat="yyyy-MM-dd";
		chart.data=json.data;
		var dateAxis=chart.xAxes.push(new am4charts.DateAxis());
		var valueAxix=chart.yAxes.push(new am4charts.ValueAxis());
		var lineSeries=chart.series.push(new am4charts.LineSeries());
		lineSeries.tooltipText = "{value}"
		lineSeries.dataFields.valueY="value";
		lineSeries.dataFields.dateX="date";
		lineSeries.tooltip.background.cornerRadius = 20;
		lineSeries.tooltip.background.strokeOpacity = 0;
		lineSeries.tooltip.pointerOrientation = "vertical";
		lineSeries.tooltip.label.minWidth = 40;
		lineSeries.tooltip.label.minHeight = 40;
		lineSeries.tooltip.label.textAlign = "middle";
		lineSeries.tooltip.label.textValign = "middle";

		var bullet = lineSeries.bullets.push(new am4charts.CircleBullet());
		bullet.circle.strokeWidth = 2;
		bullet.circle.radius = 4;
		bullet.circle.fill = am4core.color("#fff");
		var bullethover = bullet.states.create("hover");
		bullethover.properties.scale = 1.3;
		chart.cursor = new am4charts.XYCursor();
		chart.cursor.behavior = "panXY";
		chart.cursor.xAxis = dateAxis;
		chart.cursor.snapToSeries = lineSeries;
		lineSeries.name="Sales";
	}

	function statistics(){
		var url = "busstatisticAction";
		url=getQueryPath(url);
		$.post(url,function(json){
			console.log(JSON.stringify(json));
			drawChart(json);
		})
	}

</script>